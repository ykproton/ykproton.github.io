<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/cat-logo.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cat-logo.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cat-logo.jpg">
  <link rel="mask-icon" href="/images/cat-logo.jpg" color="#222">






  
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Pisces&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="安全(Security)如果Spring Security在classpath上,则默认情况下Web应用程序是安全的. Spring Boot依靠Spring Security的内容协商策略来确定是使用httpBasic还是formLogin.如果想要在应用添加方法级别的安全,可以使用@EnableGlobalMethodSecurity来进行设置.可以在Spring Security Refer">
<meta property="og:type" content="article">
<meta property="og:title" content="3.10 Feature: 安全">
<meta property="og:url" content="http://example.com/posts/58617.html">
<meta property="og:site_name" content="ykproton">
<meta property="og:description" content="安全(Security)如果Spring Security在classpath上,则默认情况下Web应用程序是安全的. Spring Boot依靠Spring Security的内容协商策略来确定是使用httpBasic还是formLogin.如果想要在应用添加方法级别的安全,可以使用@EnableGlobalMethodSecurity来进行设置.可以在Spring Security Refer">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-06-03T03:14:00.000Z">
<meta property="article:modified_time" content="2021-06-10T04:58:09.317Z">
<meta property="article:author" content="chenyk">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Spring Boot Feature">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/posts/58617.html">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;http:&#x2F;&#x2F;example.com&#x2F;posts&#x2F;58617.html&quot;,&quot;path&quot;:&quot;posts&#x2F;58617.html&quot;,&quot;title&quot;:&quot;3.10 Feature: 安全&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>3.10 Feature: 安全 | ykproton</title>
  




  <noscript>
    
  </noscript>
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ykproton</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E5%85%A8-Security"><span class="nav-number">1.</span> <span class="nav-text">安全(Security)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#MVC%E5%AE%89%E5%85%A8%E6%80%A7-MVC-Security"><span class="nav-number">1.1.</span> <span class="nav-text">MVC安全性(MVC Security)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#WebFlux%E5%AE%89%E5%85%A8%E6%80%A7-WebFlux-Security"><span class="nav-number">1.2.</span> <span class="nav-text">WebFlux安全性( WebFlux Security)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#OAuth2"><span class="nav-number">1.3.</span> <span class="nav-text">OAuth2</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-Client"><span class="nav-number">1.4.</span> <span class="nav-text">客户端(Client)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81provider%E7%9A%84OAuth2%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B3%A8%E5%86%8C-OAuth2-client-registration-for-common-providers"><span class="nav-number">1.5.</span> <span class="nav-text">常见provider的OAuth2客户端注册(OAuth2 client registration for common providers)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8-Resource-Server"><span class="nav-number">1.6.</span> <span class="nav-text">资源服务器(Resource Server)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8-Authorization-Server"><span class="nav-number">1.7.</span> <span class="nav-text">授权服务器(Authorization Server)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#SAML-2-0"><span class="nav-number">1.8.</span> <span class="nav-text">SAML 2.0</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Relying-Party"><span class="nav-number">1.9.</span> <span class="nav-text">Relying Party</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Actuator%E5%AE%89%E5%85%A8%E6%80%A7-Actuator-Security"><span class="nav-number">1.10.</span> <span class="nav-text">Actuator安全性(Actuator Security)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B7%A8%E7%AB%99%E7%82%B9%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E4%BF%9D%E6%8A%A4-Cross-Site-Request-Forgery-Protection"><span class="nav-number">1.11.</span> <span class="nav-text">跨站点请求伪造保护(Cross Site Request Forgery Protection)</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chenyk</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ykproton" title="GitHub → https://github.com/ykproton" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/58617.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          3.10 Feature: 安全
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-03 11:14:00" itemprop="dateCreated datePublished" datetime="2021-06-03T11:14:00+08:00">2021-06-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-10 12:58:09" itemprop="dateModified" datetime="2021-06-10T12:58:09+08:00">2021-06-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/58617.html" class="post-meta-item leancloud_visitors" data-flag-title="3.10 Feature: 安全" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h5 id="安全-Security"><a href="#安全-Security" class="headerlink" title="安全(Security)"></a>安全(Security)</h5><p>如果Spring Security在classpath上,则默认情况下Web应用程序是安全的. Spring Boot依靠Spring Security的内容协商策略来确定是使用<code>httpBasic</code>还是<code>formLogin</code>.如果想要在应用添加方法级别的安全,可以使用<code>@EnableGlobalMethodSecurity</code>来进行设置.可以在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.5.0/reference/html5/#jc-method">Spring Security Reference Guide</a>中获得更多信息.<br>默认的<code>UserDetailsServic</code>只有一个用户. 用户名是<code>user</code>,密码是随机的,在应用启动时在INFO级别日志输出,如下例所示:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35</span><br></pre></td></tr></tbody></table></figure>

<p>如果想要调整日志配置,确保将<code>org.springframework.boot.autoconfigure.security</code>的日志级别设置为<code>INFO</code>级别. 不然,不会打印默认密码.<br>可以通过提供<code>spring.security.user.name</code>和<code>spring.security.user.password</code>来更改用户名和密码.<br>默认情况下,您在Web应用程序中的基本功能有:</p>
<ul>
<li>保留在内存中的,<code>UserDetailsService</code>(如果是WebFlux应用程序,则为<code>ReactiveUserDetailsService</code>)Bean和一个带有生成密码的单个用户(有关用户的属性,可以参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html"><code>SecurityProperties.User</code></a>).</li>
<li>为整个应用程序提供,基于表单的登录或HTTP基本安全性(依赖请求中的<code>Accept</code>header)(如果actuator在classpath上,则包含actuator endpoints).</li>
<li>用于发布身份验证事件的<code>DefaultAuthenticationEventPublisher</code>.</li>
<li>可以添加Bean的方式来提供不同的<code>AuthenticationEventPublisher</code></li>
</ul>
<ol>
<li><h6 id="MVC安全性-MVC-Security"><a href="#MVC安全性-MVC-Security" class="headerlink" title="MVC安全性(MVC Security)"></a>MVC安全性(MVC Security)</h6>默认的安全配置在<code>SecurityAutoConfiguration</code>和<code>UserDetailsServiceAutoConfiguration</code>中实现.<code> SecurityAutoConfiguration</code>导入<code>SpringBootWebSecurityConfiguration</code>来保证网络安全,而<code>UserDetailsServiceAutoConfiguration</code>配置身份验证,这也与非Web应用程序相关.要完全关闭默认的Web应用程序安全性配置或组合多个Spring Security组件(例如OAuth2 Client和Resource Server).添加一个类型为<code>SecurityFilterChain</code>的bean(这样做不会禁用<code>UserDetailsService</code>配置或<code>Actuator</code>安全性).<br>如果要关闭<code>UserDetailsService</code>配置,可以添加类型为<code>UserDetailsService</code>,<code>AuthenticationProvider</code>或<code>AuthenticationManager</code>的bean.<br>可以添加自定义<code>SecurityFilterChain</code>或<code>WebSecurityConfigurerAdapter</code>bean,来覆盖访问规则.Spring Boot提供了方便的方法,可用来覆盖actuator endpoints和静态资源的访问规则.可以使用<code>EndpointRequest</code>创建基于<code>management.endpoints.web.base-path</code>属性的<code>RequestMatcher</code>.可以使用<code>PathRequest</code>为常用路径的资源创建一个<code>RequestMatcher</code>.</li>
<li><h6 id="WebFlux安全性-WebFlux-Security"><a href="#WebFlux安全性-WebFlux-Security" class="headerlink" title="WebFlux安全性( WebFlux Security)"></a>WebFlux安全性( WebFlux Security)</h6>与Spring MVC应用程序类似,可以添加<code>spring-boot-starter-security</code>依赖项来保护WebFlux应用程序.默认的安全配置在<code>ReactiveSecurityAutoConfiguration</code>和<code>UserDetailsServiceAutoConfiguration</code>中实现.<code>ReactiveSecurityAutoConfiguration</code>导入<code>WebFluxSecurityConfiguration</code>来实现Web安全,而<code>UserDetailsServiceAutoConfiguration</code>则用来配置身份验证,这在非Web应用程序中也很重要.如果想要完全禁用默认的Web应用安全性设置,可以添加<code>WebFilterChainProxy</code>类型的Bean来实现(这样做不会禁用<code>UserDetailsService</code>配置或Actuator的功能).<br>如果也要关闭<code>UserDetailsService</code>的配置,您可以添加<code>ReactiveUserDetailsService</code>或<code>ReactiveAuthenticationManager</code>类型的Bean.<br>通过添加自定义<code>SecurityWebFilterChain</code>bean,来配置访问规则和组合多个Spring Security组件(例如OAuth 2 Client和Resource Server).Spring Boot提供了一些可以用于覆盖 actuator endpoints和静态资源的访问规则的便捷的方法.<code>EndpointRequest</code>可用于创建基于<code>management.endpoints.web.base-path</code>属性的<code>ServerWebExchangeMatcher</code>.<br>可以使用<code>PathRequest</code>为常用路径中的资源创建<code>ServerWebExchangeMatcher</code>.<br>例如,您可以通过添加以下内容来自定义安全配置:<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebFluxSecurityConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> SecurityWebFilterChain <span class="title">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> </span>{</span><br><span class="line">  http.authorizeExchange((spec) -&gt; {</span><br><span class="line">   spec.matchers(PathRequest.toStaticResources().atCommonLocations()).permitAll();</span><br><span class="line">   spec.pathMatchers(<span class="string">"/foo"</span>, <span class="string">"/bar"</span>).authenticated();</span><br><span class="line">  });</span><br><span class="line">  http.formLogin();</span><br><span class="line">  <span class="keyword">return</span> http.build();</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h6>OAuth2是Spring支持的一种广泛使用的授权框架.<ol>
<li><h6 id="客户端-Client"><a href="#客户端-Client" class="headerlink" title="客户端(Client)"></a>客户端(Client)</h6>如果classpath上有<code>spring-security-oauth2-client</code>,则可以利用一些自动配置来设置OAuth2 / Open ID Connect客户端.这个配置使用<code>OAuth2ClientProperties</code>的属性. 相同的属性适用于servlet和响应式应用.<br>您可以在<code>spring.security.oauth2.client</code>前缀下注册多个OAuth2客户端和providers ,如以下示例所示:<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.client-id</span>=<span class="string">abcd</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.client-secret</span>=<span class="string">password</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.client-name</span>=<span class="string">Client for user scope</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.provider</span>=<span class="string">my-oauth-provider</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.scope</span>=<span class="string">user</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.redirect-uri</span>=<span class="string">https://my-redirect-uri.com</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.client-authentication-method</span>=<span class="string">basic</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type</span>=<span class="string">authorization-code</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.client-id</span>=<span class="string">abcd</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.client-secret</span>=<span class="string">password</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.client-name</span>=<span class="string">Client for email scope</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.provider</span>=<span class="string">my-oauth-provider</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.scope</span>=<span class="string">email</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.redirect-uri</span>=<span class="string">https://my-redirect-uri.com</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.client-authentication-method</span>=<span class="string">basic</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type</span>=<span class="string">authorization_code</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri</span>=<span class="string">https://my-auth-server/oauth/authorize</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.token-uri</span>=<span class="string">https://my-auth-server/oauth/token</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri</span>=<span class="string">https://my-auth-server/userinfo</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method</span>=<span class="string">header</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri</span>=<span class="string">https://my-auth-server/token_keys</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute</span>=<span class="string">name</span></span><br><span class="line">	 </span><br></pre></td></tr></tbody></table></figure>
对于支持 <a target="_blank" rel="noopener" href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect discovery</a>的OpenID Connectproviders ,可以进一步简化配置.provider需要配置一个<code>issuer-uri</code>,这是它声明Issuer Identifier的URI.例如,如果提供的issuer-uri是” <a target="_blank" rel="noopener" href="https://example.com&quot;,则将向&quot;/">https://example.com",则将向"</a> <a href="https://example.com/.well-known/openid-configuration&quot;%E5%8F%91%E5%87%BA">https://example.com/.well-known/openid-configuration"发出</a> <code>OpenID Provider Configuration Request</code>.预期结果是<code>OpenID Provider Configuration Response</code>.以下示例显示了如何使用<code>issuer-uri</code>配置OpenID Connect Provider:</li>
</ol>
  <figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.client.provider.oidc-provider.issuer-uri</span>=<span class="string">https://dev-123456.oktapreview.com/oauth2/default/</span></span><br><span class="line">	</span><br></pre></td></tr></tbody></table></figure>
   默认情况下,Spring Security的<code>OAuth2LoginAuthenticationFilter</code>仅处理与<code>/login/oauth2/code/*</code>匹配的URL.如果要自定义<code>redirect-uri</code>来使用其他pattern,则需要提供配置来处理该自定义pattern.例如,对于servlet应用程序,您可以添加自定义的<code>SecurityFilterChain</code>,如下: <figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyOAuthClientConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> SecurityFilterChain <span class="title">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">  http.authorizeRequests().anyRequest().authenticated();</span><br><span class="line">  http.oauth2Login().redirectionEndpoint().baseUri(<span class="string">"custom-callback"</span>);</span><br><span class="line">  <span class="keyword">return</span> http.build();</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">	</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>建议:</p>
<p>​    Spring Boot自动配置一个<code>InMemoryOAuth2AuthorizedClientService</code>,Spring Security使用它来管理客户端注册.<code>InMemoryOAuth2AuthorizedClientService</code>的功能有限,建议仅将其用于开发环境.对于生产环境,考虑使用<code>JdbcOAuth2AuthorizedClientService</code>或实现自己的<code>OAuth2AuthorizedClientService</code>接口.</p>
</blockquote>
<h6 id="常见provider的OAuth2客户端注册-OAuth2-client-registration-for-common-providers"><a href="#常见provider的OAuth2客户端注册-OAuth2-client-registration-for-common-providers" class="headerlink" title="常见provider的OAuth2客户端注册(OAuth2 client registration for common providers)"></a>常见provider的OAuth2客户端注册(OAuth2 client registration for common providers)</h6>   对于常见的OAuth2和OpenID providers,包括Google,Github,Facebook和Okta,我们提供了一组提供程序默认值(分别是<code>google</code>,<code>github</code>,<code>facebook</code>和<code>okta</code>)<br>   如果不需要自定义这些providers,则可以将<code>provider</code>属性设置为需要推断默认值的属性.另外,如果客户端注册的密钥与默认的支持的provider匹配,Spring Boot也会推断出该provider.<br>   换句话说,以下示例中的两种配置都使用Google provider:<pre><code> <figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client.client-id</span>=<span class="string">abcd</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client.client-secret</span>=<span class="string">password</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.my-client.provider</span>=<span class="string">google</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.google.client-id</span>=<span class="string">abcd</span></span><br><span class="line"><span class="meta">spring.security.oauth2.client.registration.google.client-secret</span>=<span class="string">password</span></span><br></pre></td></tr></tbody></table></figure>
</code></pre>
</li>
<li><h6 id="资源服务器-Resource-Server"><a href="#资源服务器-Resource-Server" class="headerlink" title="资源服务器(Resource Server)"></a>资源服务器(Resource Server)</h6> 如果您的classpath上有<code>spring-security-oauth2-resource-server</code>,则Spring Boot可以配置OAuth2资源服务器.对于JWT配置,需要指定JWK Set URI或 OIDC Issuer URI,如以下示例所示: <figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.resourceserver.jwt.jwk-set-uri</span>=<span class="string">https://example.com/oauth2/default/v1/keys</span></span><br></pre></td></tr></tbody></table></figure>
 <figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.resourceserver.jwt.issuer-uri</span>=<span class="string">https://dev-123456.oktapreview.com/oauth2/default/</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>注意:</p>
<p>​    如果授权服务器不支持JWK Set URI,则可以使用用于验证JWT签名的公钥来配置资源服务器.可以使用<code>spring.security.oauth2.resourceserver.jwt.public-key-location</code>属性完成此操作,该值需要指向包含PEM编码的x509格式的公钥的文件.</p>
</blockquote>
 相同的属性适用于servlet和响应式应用.<br> 另外,您可以为Servlet应用程序定义自己的<code>JwtDecoder</code>Bean,或者为响应式应用定义<code>ReactiveJwtDecoder</code>.<br> 如果使用不透明令牌而不是JWT,则可以配置以下属性以通过introspection来验证令牌:<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.oauth2.resourceserver.opaquetoken.introspection-uri</span>=<span class="string">https://example.com/check-token</span></span><br><span class="line"><span class="meta">spring.security.oauth2.resourceserver.opaquetoken.client-id</span>=<span class="string">my-client-id</span></span><br><span class="line"><span class="meta">spring.security.oauth2.resourceserver.opaquetoken.client-secret</span>=<span class="string">my-client-secret</span></span><br></pre></td></tr></tbody></table></figure>
 同样,相同的属性适用于servlet和响应式应用.<br> 另外,可以为Servlet应用程序定义自己的<code>OpaqueTokenIntrospector</code>Bean,或者为响应式应用定义<code>ReactiveOpaqueTokenIntrospector</code>.</li>
<li><h6 id="授权服务器-Authorization-Server"><a href="#授权服务器-Authorization-Server" class="headerlink" title="授权服务器(Authorization Server)"></a>授权服务器(Authorization Server)</h6>当前,Spring Security不支持实现OAuth 2.0授权服务器.但是,Spring Security OAuth项目提供了此功能,这最终将被Spring Security完全取代.在此之前,可以使用<code>spring-security-oauth2-autoconfigure</code>模块来很容易地设置OAuth 2.0授权服务器； 有关说明,请参见 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security-oauth2-boot/">documentation</a> .</li>
<li><h6 id="SAML-2-0"><a href="#SAML-2-0" class="headerlink" title="SAML 2.0"></a>SAML 2.0</h6><ol>
<li><h6 id="Relying-Party"><a href="#Relying-Party" class="headerlink" title="Relying Party"></a>Relying Party</h6>如果您在classpath中具有<code>spring-security-saml2-service-provider</code>,则可以使用自动配置来设置SAML 2.0依赖方.此配置使用<code>Saml2RelyingPartyProperties</code>下的属性.<br>一个依赖方注册代表 Identity Provider, IDP和Service Provider, SP之间的配对配置.可以在<code>spring.security.saml2.relyingparty</code>前缀下注册多个依赖方,如以下示例所示:</li>
</ol>
  <figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.signing.credentials[0].private-key-location</span>=<span class="string">path-to-private-key</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.signing.credentials[0].certificate-location</span>=<span class="string">path-to-certificate</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.decryption.credentials[0].private-key-location</span>=<span class="string">path-to-private-key</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.decryption.credentials[0].certificate-location</span>=<span class="string">path-to-certificate</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.verification.credentials[0].certificate-location</span>=<span class="string">path-to-verification-cert</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.entity-id</span>=<span class="string">remote-idp-entity-id1</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.sso-url</span>=<span class="string">https://remoteidp1.sso.url</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.signing.credentials[0].private-key-location</span>=<span class="string">path-to-private-key</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.signing.credentials[0].certificate-location</span>=<span class="string">path-to-certificate</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.decryption.credentials[0].private-key-location</span>=<span class="string">path-to-private-key</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.decryption.credentials[0].certificate-location</span>=<span class="string">path-to-certificate</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.verification.credentials[0].certificate-location</span>=<span class="string">path-to-other-verification-cert</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.entity-id</span>=<span class="string">remote-idp-entity-id2</span></span><br><span class="line"><span class="meta">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.sso-url</span>=<span class="string">https://remoteidp2.sso.url</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="Actuator安全性-Actuator-Security"><a href="#Actuator安全性-Actuator-Security" class="headerlink" title="Actuator安全性(Actuator Security)"></a>Actuator安全性(Actuator Security)</h6>为了安全起见,默认情况下禁用<code>/health</code>以外的所有actuator.可以使用 <code>management.endpoints.web.exposure.include</code>启用actuator.<br>如果Spring Security位于classpath中,并且不存在其他<code>WebSecurityConfigurerAdapter</code>或<code>SecurityFilterChain</code>Bean,则<code>/health</code>以外的actuators均由Spring Boot自动配置保护.如果自定义了<code>WebSecurityConfigurerAdapter</code>或<code>SecurityFilterChain</code>bean,那么Spring Boot的自动配置将退出,开发者将完全控制actuator访问规则.<blockquote>
<p>建议:</p>
<p>​    在设置<code>management.endpoints.web.exposure.include</code>之前,请确保公开的actuator不包含敏感信息和/或通过将它们放置在防火墙后面,或者使用Spring Security之类的方法进行保护.</p>
</blockquote>
<ol>
<li><h6 id="跨站点请求伪造保护-Cross-Site-Request-Forgery-Protection"><a href="#跨站点请求伪造保护-Cross-Site-Request-Forgery-Protection" class="headerlink" title="跨站点请求伪造保护(Cross Site Request Forgery Protection)"></a>跨站点请求伪造保护(Cross Site Request Forgery Protection)</h6>由于Spring Boot使用Spring Security的默认设置,因此CSRF保护默认情况下处于启用状态. 这意味着在使用默认安全配置时,需要<code>POST</code>(关闭和记录器endpoint),<code>PUT</code>或<code>DELETE</code>的actuator endpoint将收到403禁止错误.<blockquote>
<p>建议:</p>
<p>​    如果创建的服务,只是给非浏览器的客户端使用时,建议完全禁用CSRF保护.</p>
</blockquote>
</li>
</ol>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
              <a href="/tags/Spring-Boot-Feature/" rel="tag"># Spring Boot Feature</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/32243.html" rel="prev" title="3.9 Feature: RSocket">
                  <i class="fa fa-chevron-left"></i> 3.9 Feature: RSocket
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/58530.html" rel="next" title="3.11 Feature: 使用SQL数据库">
                  3.11 Feature: 使用SQL数据库 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  © 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenyk</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">337k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:06</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>


  





  
  

  
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  
  


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  
  



<script src="/bundle.js"></script><script>{&quot;enable&quot;:true,&quot;spinner&quot;:true};
{&quot;enable&quot;:true,&quot;app_id&quot;:null,&quot;app_key&quot;:null,&quot;server_url&quot;:null,&quot;security&quot;:true};
{&quot;enable&quot;:true,&quot;home&quot;:true,&quot;archive&quot;:true,&quot;delay&quot;:true,&quot;timeout&quot;:3000,&quot;priority&quot;:true,&quot;ignores&quot;:null,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&#x2F;posts&#x2F;58617.html&quot;}</script></body></html>